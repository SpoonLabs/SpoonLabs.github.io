<!DOCTYPE html>
<html lang="en">
<html>
  <head>

 <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="processor,  processor, processing, elements">
<title>More about Spoon Processors  | Spoon</title>
<link rel="stylesheet" type="text/css" href="css/syntax.css">
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/modern-business.css">
<link rel="stylesheet" type="text/css" href="css/lavish-bootstrap.css">
<link rel="canonical" href="/processor.html">
<link rel="stylesheet" type="text/css" href="css/customstyles.css">
<link rel="stylesheet" type="text/css" href="css/theme-mauve.css">
<link rel="canonical" href="/processor.html">
<link rel="alternate" type="application/rss+xml" title="" href="feed.xml" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->







 

  <script>
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })
  </script>

  </head>

  <body>

   <!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Spoon</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                




                
                
                
                
                <li><a href="papers.html">Papers</a></li>
                
                
                
                
                
                <li><a href="ecosystem.html">Ecosystem</a></li>
                
                
                
                
                
                <li><a href="about.html">About</a></li>
                
                
                
                
                
                <li><a href="https://ci.inria.fr/sos/" target="_blank">Jenkins</a></li>
                
                
                
                
                
                <li><a href="https://github.com/INRIA/spoon" target="_blank">Github</a></li>
                
                
                
                


                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->

                <li class="dropdown">
                    
        </div>
        <!-- /.container -->
</nav>


    <!-- Page Content -->
    <div class="container">
      <div class="col-lg-12">&nbsp;</div>

      <!-- Content Row -->
<div class="row">
    <!-- Sidebar Column -->
    <div class="col-md-3">

        <script>

            $(document).ready(function() {
                        // Initialize navgoco with default options
                        $("#mysidebar").navgoco({
                            caretHtml: '',
                            accordion: true,
                            openClass: 'active', // open
                            save: false, // leave false or nav highlighting doesn't work right
                            cookie: {
                                name: 'navgoco',
                                expires: false,
                                path: '/'
                        },
                        slide: {
                            duration: 400,
                            easing: 'swing'
                                }
                                });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

            });

        </script>


        




        <ul id="mysidebar" class="nav">

            <div class="siteTagline">Spoon</div>

            
            
            
            <li><a href="#">Getting started</a>
                <ul>
                    
                    
                    
                    <li><a href="first_analysis_processor.html">Code Analysis</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="architecture_test.html">Architecture Checking</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="reflection.html">Runtime Reflection</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="custom-pretty-printing.html">Custom Java Pretty-Printing</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li class="active"><a href="processor.html">Processor for elements</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="/mvnsites/spoon-core/apidocs" target="_blank">Javadoc</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="faq.html">FAQ</a></li>
                    

                    
            </li>
            
            
            </ul>
        </li>
        
        
            
            <li><a href="#">Querying source code elements</a>
                <ul>
                    
                    
                    
                    <li><a href="filter.html">AST Traversing</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="path.html">AST Paths and Roles</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="matcher.html">Matcher</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="pattern.html">Pattern</a></li>
                    

                    
            </li>
            
            
            </ul>
        </li>
        
        
            
            <li><a href="#">Code Transformation</a>
                <ul>
                    
                    
                    
                    <li><a href="first_transformation.html">Code Transformation</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="examples.html">Transformation Examples</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="processor_annotations.html">Transformation with annotations</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="template_definition.html">Transformation with Templates</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="spoon_smpl.html">Semantic patching</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="pattern.html#generator">Code Generation</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="testing_quickstart.html">Testing transformations</a></li>
                    

                    
            </li>
            
            
            </ul>
        </li>
        
        
            
            <li><a href="#">Usage</a>
                <ul>
                    
                    
                    
                    <li><a href="launcher.html">From Java</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="command_line.html">Command Line</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="maven.html">From Maven Plugin</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="gradle.html">From Gradle Plugin</a></li>
                    

                    
            </li>
            
            
            </ul>
        </li>
        
        
            
            <li><a href="#">Spoon Meta model</a>
                <ul>
                    
                    
                    
                    <li><a href="structural_elements.html">Structural elements</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="code_elements.html">Code elements</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="references.html">References</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="factories.html">Create elements with factories</a></li>
                    

                    
            </li>
            
            
                    
                    
                    <li><a href="comments.html">Comments and Positions</a></li>
                    

                    
            </li>
            
            
            </ul>
        </li>
        
        
        
        </ul>

        
    </div>
       <!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above.-->
    <script>$("li.active").parents('li').toggleClass("active");</script>


      <!-- Content Column -->
      <div class="col-md-9">

          <div class="post-header">
   <h1 class="post-title-main">More about Spoon Processors</h1>
</div>

<div class="post-content">

   

  <p>A program analysis is a combination of query and analysis code.
In Spoon, this conceptual pair is reified in a <code class="language-plaintext highlighter-rouge">processor</code>.
A Spoon processor is a class that focuses on the analysis of one 
kind of program elements. For instance, the processor at the end of 
this page presents a processor that analyzes a program to find 
empty catch blocks.</p>

<p>The elements to be analyzed (here catch blocks), are given by generic typing: 
the programmer declares the AST node type under analysis as class generics. 
The processed element type is automatically inferred through runtime introspection 
of the processor class. There is also an optional overridable method for querying 
elements at a finer grain.</p>

<p>The process method takes the requested element as input and does the analysis 
(here detecting empty catch blocks). At any time, you can interrupt the processing 
of the model with a call to <code class="language-plaintext highlighter-rouge">interrupt()</code> (this stops all processors, and proceeds 
with the next step which is usually pretty-printing the code to disk).</p>

<p>Since a real world analysis combines multiple queries, multiple processors can 
be used at the same time. The launcher applies them in the order they have been declared.</p>

<p>Processors are implemented with a visitor design pattern applied to the Spoon 
Java model. Each node of the metamodel implements an <code class="language-plaintext highlighter-rouge">accept</code> method so that it 
can be visited by a visitor object, which can perform any kind of action, 
including modification.</p>

<div class="alert alert-success" role="alert"><i class="fa fa-check-square-o"></i> <b>Tip: </b>
 Spoon provides developers with an intuitive Java metamodel and concise abstractions 
 to query and process AST elements.
</div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">fr.inria.gforge.spoon.processors</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.log4j.Level</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spoon.processing.AbstractProcessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spoon.reflect.code.CtCatch</span><span class="o">;</span>

<span class="cm">/**
 * Reports warnings when empty catch blocks are found.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CatchProcessor</span> <span class="kd">extends</span> <span class="nc">AbstractProcessor</span><span class="o">&lt;</span><span class="nc">CtCatch</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="nc">CtCatch</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getBody</span><span class="o">().</span><span class="na">getStatements</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">getFactory</span><span class="o">().</span><span class="na">getEnvironment</span><span class="o">().</span><span class="na">report</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">Level</span><span class="o">.</span><span class="na">WARN</span><span class="o">,</span> <span class="n">element</span><span class="o">,</span> <span class="s">"empty catch clause"</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<h3 id="examples-of-analysis-processors">Examples of Analysis Processors</h3>

<p>The <a href="https://github.com/SpoonLabs/spoon-examples/blob/master/src/main/java/fr/inria/gforge/spoon/HelloWorldProcessor.java">HelloWorldProcessor example</a> prints hello world with compile-time reflection.</p>

<p>The <a href="https://github.com/SpoonLabs/spoon-examples/blob/master/src/main/java/fr/inria/gforge/spoon/analysis/CatchProcessor.java">CatchProcessor example</a> detects empty catch blocks.</p>

<p>The <a href="https://github.com/SpoonLabs/spoon-examples/blob/master/src/main/java/fr/inria/gforge/spoon/analysis/ReferenceProcessor.java">ReferenceProcessor example</a> detects circular references between packages.</p>

<p>This <a href="https://github.com/SpoonLabs/spoon-examples/blob/master/src/main/java/fr/inria/gforge/spoon/analysis/FactoryProcessor.java">Factory example</a> example detects wrong uses of the factory pattern.</p>

<h3 id="parallel-processor">Parallel Processor</h3>

<p>Lets assume you want to use multiple cores for your processor. Spoon provides a simple high-level API for this task.
Using the CatchProcessor from before create a <code class="language-plaintext highlighter-rouge">AbstractParallelProcessor</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>			<span class="nc">Processor</span><span class="o">&lt;</span><span class="nc">CtCatch</span><span class="o">&gt;</span> <span class="n">parallelProcessor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AbstractParallelProcessor</span><span class="o">&lt;</span><span class="nc">CtCatch</span><span class="o">&gt;(</span>
				<span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="nc">CatchProcessor</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">CatchProcessor</span><span class="o">()))</span> <span class="o">{};</span>
</code></pre></div></div>
<p>Now you have the same processor behavior as before, but 2 parallel running processor.
You can upscale this pretty high, but keep in mind to not use more parallel processors than available cores for maximum speedup.
For more information about parallel processor and the API have a look in the <a href="http://spoon.gforge.inria.fr/mvnsites/spoon-core/apidocs/spoon/processing/AbstractParallelProcessor.html">documentation</a>.</p>






















































































































































</div>

<hr class="shaded"/> 

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               	<a href="https://github.com/INRIA/spoon/issues/new">Contact / Feedback / Question / Bug Report</a><br />
                Site last generated: Apr 21, 2021 <br />
                </div>
            </div>
        </footer>

      </div><!-- /.row -->

    </div>    <!-- /.container -->

  </body>

  
  <!-- the google_analytics_id gets auto inserted from the config file -->


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-24273081-1', 'auto');
    ga('send', 'pageview');
</script>

  

</html>

